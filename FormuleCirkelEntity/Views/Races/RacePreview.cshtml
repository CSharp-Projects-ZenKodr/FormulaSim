@model FormuleCirkelEntity.Models.Race

@{
    ViewData["Title"] = "Preview";
}

<div id="graphic">
    <h1>Preview of @Model.Name</h1>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            Round
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Round)
        </dd>
        <dt class="col-sm-2">
            Location
        </dt>
        <dd class="col-sm-10">
            @(Model.Track.Location)
        </dd>
        <dt class="col-sm-2">
            Track
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Track.Name)
        </dd>
        <dt class="col-sm-2">
            Specification
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Track.Specification)
        </dd>
        <dt class="col-sm-2">
            Weather
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Weather)
            <span><i id="weather"></i></span>
        </dd>
        <dt class="col-sm-2">
            DNF chance
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Track.DNFodds)
        </dd>
        <dt class="col-sm-2">
            RNG
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Track.RNGodds)
        </dd>
    </dl>
    <hr />
    <table class="table table-bordered table-dark table-sm">
        <thead>
            <tr>
                <th>#</th>
                <th>Chassis</th>
                <th>Engine</th>
                <th>Driver</th>
                <th>Qualy bonus</th>
                <th>Tire bonus</th>
                <th>Tire wear</th>
                <th>Reliability</th>
                <th>RNG min.</th>
                <th>RNG max.</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var stint in Model.Stints)
            {
                <tr>
                    <td>@stint.Key</td>
                    <td>
                        @if (stint.Value.ApplyChassisLevel)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>
                        @if (stint.Value.ApplyEngineLevel)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>
                        @if (stint.Value.ApplyDriverLevel)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>
                        @if (stint.Value.ApplyQualifyingBonus)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>
                        @if (stint.Value.ApplyTireLevel)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>
                        @if (stint.Value.ApplyTireWear)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>
                        @if (stint.Value.ApplyReliability)
                        {<span class="badge badge-success nofullwidth">✓</span>}
                    </td>
                    <td>@stint.Value.RNGMinimum</td>
                    <td>@stint.Value.RNGMaximum</td>
                </tr>
            }
        </tbody>
    </table>
    <table class="table table-sm">
        <thead>
            <tr>
                <th colspan="3">Favourites</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var driver in ViewBag.favourites)
            {
                <tr>
                    <td><span class="badge" style="background-color:@(driver.SeasonTeam.Team.Colour);color:@(driver.SeasonTeam.Team.Accent);font-size:1rem;">@(driver.Driver.DriverNumber)</span></td>
                    <td>@(driver.Driver.Name)</td>
                    <td><span class="badge" style="background-color:@(driver.SeasonTeam.Team.Colour);color:@(driver.SeasonTeam.Team.Accent);font-size:1rem;">@(driver.SeasonTeam.Team.Name)</span></td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="row">
    <form asp-action="RacePreview">
        <div class="form-group">
            <input asp-action="RaceStart" asp-route-id="@Model.SeasonId" asp-route-raceId="@Model.RaceId" type="submit" value="Raceweekend" class="btn btn-dark" />
        </div>
    </form>
    <button class="btn ml-auto" onclick="takeScreenshot('#graphic', '#screenshot')"><i class="fas fa-image fa-2x"></i></button>
</div>
<br />

<div id="screenshot"></div>

@Html.Raw(TempData["msg"])

<script>
    $(function () {
        var weatherclass = "";
        switch ("@Model.Weather") {
            case "Sunny":
                weatherclass = "fas fa-sun";
                break;
            case "Overcast":
                weatherclass = "fas fa-cloud";
                break;
            case "Rain":
                weatherclass = "fas fa-cloud-rain";
                break;
            case "Storm":
                weatherclass = "fas fa-cloud-moon-rain";
                break;
        }
        $("#weather").addClass(weatherclass);
    });
</script>