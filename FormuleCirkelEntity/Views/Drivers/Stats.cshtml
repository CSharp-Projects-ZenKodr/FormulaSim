@model FormuleCirkelEntity.ViewModels.DriverStatsModel

@{
    ViewData["Title"] = "Driver bio";
}

<h1>Biography</h1>
<h4>@Model.Driver.Name</h4>
<hr />

<div class="biocontainer">
    <div class="fixed">
        <dl class="inline-flex">
            <dt>
                Aantal starts:
            </dt>
            <dd>
                @Model.DriverResults.Count()
            </dd>
            <dt>
                Aantal poles:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Grid == 1).Count())
            </dd>
            <dt>
                Aantal podia:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Position <= 3).Count())
            </dd>
            <dt>
                Aantal winsten:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Position == 1).Count())
            </dd>
            <dt>
                Aantal WDCs:
            </dt>
            <dd>
                @ViewBag.championships
            </dd>
            <dt>
                Aantal DNFs:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Status == Status.DNF).Count())
            </dd>
            <dt>
                Gereden voor:
            </dt>
            <dd>
                @foreach (var team in Model.SeasonDriver.Select(select => select.SeasonTeam.Team).Distinct())
                {
                    <span class='badge' style='background-color:@(team.Colour);color:@(team.Accent);font-size:1rem;'>@(team.Abbreviation)</span>
                }
            </dd>
        </dl>
    </div>
    <div class="flex-item">
        <p id="biography" contenteditable="true">
            @if (Model.Driver.Biography == null)
            {
                <i>This driver has no bio yet!</i>
            }
            else
            {
                @Model.Driver.Biography
            }
        </p>
        <button id="savebio" class="btn btn-dark"><i class="far fa-save"></i></button>
    </div>
</div>

<div>
    <a asp-action="Index">
        <i class="fas fa-arrow-alt-circle-left fa-2x"></i>
    </a>
</div>

<script>
    $('#savebio').click(function () {
        $.ajax({
            type: "POST",
            url: "/Drivers/SaveBiography",
            data: { id: @Model.Driver.DriverId, biography: $("#biography").text() },
            dataType: "html",
            success: function () { alert("Biografie opgeslagen!"); },
            error: function () { alert("Opslaan mislukt!"); }
        });
    });
</script>