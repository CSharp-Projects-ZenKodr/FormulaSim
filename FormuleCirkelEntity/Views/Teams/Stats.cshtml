@model FormuleCirkelEntity.ViewModels.TeamStatsModel

@{
    ViewData["Title"] = "Team bio";
}

<h1>Biography</h1>
<h4 class='badge' style='background-color:@(Model.Team.Colour);color:@(Model.Team.Accent);font-size:1.5rem;'>@Model.Team.Name</h4>
<hr />

<div class="biocontainer">
    <div class="fixed">
        <dl class="inline-flex">
            <dt>
                Aantal starts:
            </dt>
            <dd>
                @(Model.DriverResults.Count() / 2)
            </dd>
            <dt>
                Aantal poles:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Grid == 1).Count())
            </dd>
            <dt>
                Aantal podia:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Position <= 3).Count())
            </dd>
            <dt>
                Aantal winsten:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Position == 1).Count())
            </dd>
            <dt>
                Aantal WDCs:
            </dt>
            <dd>
                @ViewBag.driverchampionships
            </dd>
            <dt>
                Aantal WCCs:
            </dt>
            <dd>
                @ViewBag.teamchampionships
            </dd>
            <dt>
                Aantal DNFs:
            </dt>
            <dd>
                @(Model.DriverResults.Where(dr => dr.Status == Status.DNF).Count())
            </dd>
            <dt>
                Historie coureurs:
            </dt>
            <dd>
                @foreach (var driver in Model.SeasonDriver.Select(s => s.Driver).Distinct())
                {
                    <span class="badge badge-light">@(driver.Name)</span>
                }
            </dd>
        </dl>
    </div>
    <div class="flex-item">
        <p id="biography" contenteditable="true">
            @if(Model.Team.Biography == null)
            {
                <i>This team has no bio yet!</i>
            } else
            {
                @Model.Team.Biography
            }
        </p>
        <button id="savebio" class="btn btn-dark">Save</button>
    </div>
</div>

<div>
    <a asp-action="Index">
        <i class="fas fa-arrow-alt-circle-left"></i>
    </a>
</div>

<script>
    $('#savebio').click(function () {
        $.ajax({
            type: "POST",
            url: "/Teams/SaveBiography",
            data: { id: @Model.Team.TeamId, biography: $("#biography").text() },
            dataType: "html",
            success: function () { alert("Biografie opgeslagen!"); },
            error: function () { alert("Opslaan mislukt!"); }
        });
    });
</script>